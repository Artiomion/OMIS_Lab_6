{% extends "base.html" %}

{% block title %}–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏{% endblock %}

{% block content %}
<h2>üë• –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏</h2>

<div class="search-box">
    <form method="GET">
        <input type="text" name="q" value="{{ search_query }}" 
               placeholder="–ü–æ–∏—Å–∫ –ø–æ –∏–º–µ–Ω–∏ –∏–ª–∏ email..." autofocus>
    </form>
</div>

{% if users.items %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>–ò–º—è</th>
                <th>Email</th>
                <th>–†–æ–ª—å</th>
                <th>–î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏</th>
                <th>–°—Ç–∞—Ç—É—Å</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
        </thead>
        <tbody>
            {% for user in users.items %}
            <tr>
                <td>{{ user.id }}</td>
                <td>{{ user.name }}</td>
                <td>{{ user.email }}</td>
                <td><span class="badge">{{ user.role }}</span></td>
                <td>{{ user.created_at.strftime('%d.%m.%Y') }}</td>
                <td>
                    {% if user.is_blocked %}
                        <span class="badge rejected">–ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω</span>
                    {% else %}
                        <span class="badge accepted">–ê–∫—Ç–∏–≤–µ–Ω</span>
                    {% endif %}
                </td>
                <td>
                    {% if user.id != current_user.id %}
                        {% if not user.is_blocked %}
                            <form method="POST" action="{{ url_for('admin.block_user', user_id=user.id) }}" style="display: inline;">
                                <button type="submit" class="button danger" style="padding: 0.3rem 0.6rem; font-size: 0.85rem;">
                                    –ó–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </form>
                        {% else %}
                            <form method="POST" action="{{ url_for('admin.unblock_user', user_id=user.id) }}" style="display: inline;">
                                <button type="submit" class="button success" style="padding: 0.3rem 0.6rem; font-size: 0.85rem;">
                                    –†–∞–∑–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å
                                </button>
                            </form>
                        {% endif %}
                        <form method="POST" action="{{ url_for('admin.delete_user', user_id=user.id) }}" style="display: inline;" 
                              onsubmit="return confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å —ç—Ç–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è?');">
                            <button type="submit" class="button danger" style="padding: 0.3rem 0.6rem; font-size: 0.85rem;">
                                –£–¥–∞–ª–∏—Ç—å
                            </button>
                        </form>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
    
    <!-- Pagination -->
    <div style="margin-top: 2rem; text-align: center;">
        {% if users.has_prev %}
            <a href="{{ url_for('admin.users', page=users.prev_num, q=search_query) }}" class="button secondary">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</a>
        {% endif %}
        <span style="margin: 0 1rem;">–°—Ç—Ä–∞–Ω–∏—Ü–∞ {{ users.page }} –∏–∑ {{ users.pages }}</span>
        {% if users.has_next %}
            <a href="{{ url_for('admin.users', page=users.next_num, q=search_query) }}" class="button secondary">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</a>
        {% endif %}
    </div>
{% else %}
    <div class="empty-state">
        <p>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>
    </div>
{% endif %}
{% endblock %}